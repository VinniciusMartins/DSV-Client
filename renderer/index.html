<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>DSV-Client – Print</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Design tokens & modern styles -->
    <style>
        :root{
            --bg: #0b1020;
            --panel: #121b36;
            --panel-2: #0f1730;
            --text: #e8eefc;
            --muted: #a7b3d9;
            --primary: #6ea8fe;
            --primary-600: #4e92ff;
            --success: #18a558;
            --warn: #ffc107;
            --error: #dc3545;
            --info: #0d6efd;
            --border: rgba(255,255,255,.08);
            --shadow: 0 10px 30px rgba(0,0,0,.35);
            --radius: 14px;
            --radius-sm: 10px;
            --radius-lg: 18px;
            --ring: 0 0 0 2px rgba(110,168,254,.35);
            --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
            --sans: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
        }

        * { box-sizing: border-box; }
        html, body { height: 100%;  -ms-overflow-style: none; scrollbar-width: none; }
        body {
            margin: 0; font-family: var(--sans); color: var(--text); background: radial-gradient(1200px 800px at 20% -10%, #18244b 0%, #0b1020 60%) fixed, var(--bg);
            -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
        }

        html::-webkit-scrollbar,
        body::-webkit-scrollbar {
            width: 0;
            height: 0;
            background: transparent;
        }

        .shell {
            max-width: 1150px; margin: 24px auto; padding: 0 18px;
            display: grid; grid-template-rows: auto auto 1fr; gap: 18px;
        }

        /* Topbar */
        .topbar {
            display: grid; grid-template-columns: 1fr auto; gap: 12px; align-items: center;
            background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
            border: 1px solid var(--border); border-radius: var(--radius); padding: 14px 16px; box-shadow: var(--shadow);
            backdrop-filter: blur(6px);
        }
        .brand { display: flex; align-items: center; gap: 12px; }
        .brand img { width: 26px; height: 26px; border-radius: 6px; filter: drop-shadow(0 4px 8px rgba(0,0,0,.3)); }
        .brand h1 { font-size: 16px; margin: 0; letter-spacing: .3px; font-weight: 600; }
        .user {
            display: flex; align-items: center; gap: 10px; color: var(--muted); font-size: 13px;
        }
        .pill {
            padding: 6px 10px; border: 1px solid var(--border); border-radius: 999px;
            background: rgba(255,255,255,.03);
        }

        .btn {
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 9px 12px;
            background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
            color: var(--text);
            cursor: pointer; transition: .18s ease;
            display: inline-flex; align-items: center; gap: 8px; font-weight: 600; letter-spacing: .2px;
        }
        .btn svg { width: 16px; height: 16px; }
        .btn:hover { transform: translateY(-1px); box-shadow: 0 6px 14px rgba(0,0,0,.25); }
        .btn:active { transform: translateY(0); box-shadow: none; }
        .btn:focus-visible { outline: none; box-shadow: var(--ring); }
        .btn-primary { background: linear-gradient(180deg, var(--primary), var(--primary-600)); border-color: transparent;}
        .btn-ghost { background: rgba(255,255,255,.04); }
        .btn-danger { background: linear-gradient(180deg, #ff6b6b, #dc3545); border-color: transparent; }
        .btn:disabled { opacity: .6; cursor: not-allowed; box-shadow: none; transform: none; }

        /* Content grid */
        .content {
            display: grid;
            grid-template-columns: 1.1fr .9fr;
            gap: 18px;
        }
        @media (max-width: 980px) {
            .content { grid-template-columns: 1fr; }
        }

        .card {
            background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
            border: 1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow);
            backdrop-filter: blur(5px);
        }
        .card .hd {
            padding: 14px 16px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; gap: 10px;
        }
        .card .hd h3 { margin: 0; font-size: 14px; letter-spacing: .3px; text-transform: uppercase; color: var(--muted); }
        .card .bd { padding: 16px; }

        .row { display: grid; gap: 12px; margin-bottom: 12px; }
        .grid-2 { grid-template-columns: 1fr 1fr; }
        .grid-3 { grid-template-columns: 1fr 1fr 1fr; }
        @media (max-width: 820px) {
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
        }

        label { font-size: 13px; color: var(--muted); }
        select, input[type="text"], input[type="search"] {
            width: 100%; padding: 10px 12px; border-radius: 10px;
            border: 1px solid var(--border);
            background: var(--panel-2); color: var(--text);
            outline: none; transition: .16s ease;
        }
        input::placeholder { color: #9fb0db; opacity: .65; }
        select:focus, input:focus { box-shadow: var(--ring); }

        .statusbar {
            display: grid; grid-template-columns: 1fr 1fr; gap: 12px;
        }
        .status-kv {
            background: rgba(255,255,255,.03);
            border: 1px dashed var(--border);
            border-radius: 10px; padding: 12px 14px;
            display: grid; grid-template-columns: auto 1fr; gap: 10px; align-items: center;
        }
        .status-kv .k { color: var(--muted); font-size: 13px; }
        .status-kv .v { font-weight: 700; }

        /* status badge (reuses existing .status id) */
        #status.ok   { color: var(--success); }
        #status.warn { color: var(--warn); }
        #status.err  { color: var(--error); }

        /* Ticker (job cards) */
        .ticker {
            display: flex; gap: 12px; overflow-x: auto; padding: 10px;
            border: 1px dashed var(--border); border-radius: var(--radius-sm);
            background: rgba(255,255,255,.04);
            scrollbar-width: thin;
        }
        .ticker::-webkit-scrollbar { height: 8px; }
        .ticker::-webkit-scrollbar-thumb { background: rgba(255,255,255,.12); border-radius: 999px; }

        .tick {
            min-width: 190px;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 10px 12px;
            background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
            box-shadow: 0 6px 16px rgba(0,0,0,.25);
            transition: .16s ease;
        }
        .tick:hover { transform: translateY(-2px); }
        .tick .ts { display: block; font-size: 11px; color: var(--muted); }
        .tick .label { display: inline-block; font-weight: 700; margin: 6px 0 2px; }
        .tick.success { background: linear-gradient(180deg, rgba(24,165,88,.95), rgba(24,165,88,.85)); color: #fff; border-color: transparent; }
        .tick.printing { background: linear-gradient(180deg, rgba(255,193,7,.9), rgba(255,193,7,.8)); color: #041126; border-color: transparent; }
        .tick.deleted { background: linear-gradient(180deg, rgba(220,53,69,.95), rgba(220,53,69,.85)); color: #fff; border-color: transparent; }
        .tick.paused { background: linear-gradient(180deg, rgba(108,117,125,.95), rgba(108,117,125,.85)); color: #fff; border-color: transparent; }
        .tick.waiting { background: linear-gradient(180deg, rgba(255,255,255,.15), rgba(255,255,255,.05)); color: var(--text); }
        .tick.retained { background: linear-gradient(180deg, rgba(13,110,253,.95), rgba(13,110,253,.85)); color: #fff; border-color: transparent; }

        /* Log console */
        .log {
            font-family: var(--mono);
            white-space: pre-wrap;
            background: #0a0f1e;
            color: #dfe7ff;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            padding: 12px; min-height: 180px;
            line-height: 1.35;
            box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);
        }

        .toolbar { display: flex; gap: 10px; flex-wrap: wrap; }

        /* Tiny badges */
        .badge {
            font-size: 11px; padding: 4px 8px; border-radius: 999px; border: 1px solid var(--border); color: var(--muted);
            background: rgba(255,255,255,.03);
        }

    </style>
</head>

<body>
<div class="shell">
    <!-- Top bar -->
    <div class="topbar">
        <div class="brand">
            <img src="../assets/printer.png" alt="DSV-Client" />
            <h1>DSV-Client <span class="badge">Print</span></h1>
        </div>
        <div class="user">
            <span id="userEmail" class="pill">Not signed in</span>
            <button id="logoutBtn" class="btn btn-ghost" title="Sign out" type="button" aria-label="Logout">
                <!-- door icon -->
                <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M10 3a1 1 0 0 0-1 1v4h2V5h8v14h-8v-3H9v4a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1H10z"/><path d="M13.7 15.3a1 1 0 0 0 1.4 1.4l4-4a1 1 0 0 0 0-1.4l-4-4a1 1 0 1 0-1.4 1.4L15.59 10H4a1 1 0 0 0 0 2h11.59l-1.89 1.3z"/></svg>
                Logout
            </button>
        </div>
    </div>

    <!-- Controls -->
    <div class="card">
        <div class="hd">
            <h3>Print controls</h3>
            <div class="toolbar">
                <button id="refreshPrinters" class="btn btn-ghost" type="button" title="Refresh printer list">
                    <!-- refresh icon -->
                    <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M17.65 6.35A7.95 7.95 0 0 0 12 4V1L7 6l5 5V7c3.31 0 6 2.69 6 6a6 6 0 0 1-6 6 6 6 0 0 1-5.65-4H4.26A8 8 0 0 0 20 13c0-2.21-.9-4.21-2.35-5.65z"/></svg>
                    Refresh
                </button>
                <span id="refreshInfo" class="pill">—</span>
            </div>
        </div>
        <div class="bd">
            <div class="row grid-3">
                <div>
                    <label for="printer">Printer</label>
                    <select id="printer" aria-label="Choose printer"></select>
                </div>
                <div class="">
                    <label for="pdfPath">PDF path</label>
                    <input id="pdfPath" type="text" placeholder="C:\Users\vinni\Downloads\dummy.pdf" value="C:\Users\vinni\Downloads\dummy.pdf" />
                </div>
                <div class="toolbar" style="align-items:end;">
                    <button id="printBtn" class="btn btn-primary" type="button" title="Send PDF to printer">
                        <!-- printer icon -->
                        <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M17 3H7v4h10V3zM6 13H4v6h4v-3h8v3h4v-6h-2v-3a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v3z"/></svg>
                        Print
                    </button>
                    <button id="stopBtn" class="btn btn-danger" type="button" title="Stop watching current job">
                        <!-- square icon -->
                        <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><rect x="6" y="6" width="12" height="12" rx="2"/></svg>
                        Stop Watch
                    </button>
                </div>
            </div>

            <div class="statusbar">
                <div class="status-kv">
                    <!-- badge icon -->
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 2l3 4 5 1-3 4 .5 5L12 14l-5.5 2L7 11 4 7l5-1 3-4z"/></svg>
                    <div>
                        <div class="k">Latest job</div>
                        <div id="jobInfo" class="v">—</div>
                    </div>
                </div>
                <div class="status-kv">
                    <!-- heartbeat icon -->
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M2 12h4l2 5 3-10 2 6h9"/><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 1 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" opacity=".25"/></svg>
                    <div>
                        <div class="k">Tracking status</div>
                        <div id="status" class="v">—</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ticker & logs -->
    <div class="content">
        <div class="card">
            <div class="hd">
                <h3>Live jobs</h3>
                <span class="badge">Newest on the left</span>
            </div>
            <div class="bd">
                <div id="ticker" class="ticker" aria-live="polite" aria-label="Job status ticker"></div>
            </div>
        </div>

        <div class="card">
            <div class="hd">
                <h3>Console</h3>
                <span class="badge">Events & diagnostics</span>
            </div>
            <div class="bd">
                <div id="log" class="log"></div>
            </div>
        </div>
    </div>
</div>

<!-- App logic -->
<script src="./app.js"></script>

<!-- Enhance with user info + logout (AuthAPI is exposed in preload.js) -->
<script>
    (async () => {
        try {
            const badge = document.getElementById('userEmail');
            const outBtn = document.getElementById('logoutBtn');

            if (window.AuthAPI?.getUser) {
                const res = await window.AuthAPI.getUser();
                if (res && res.success && res.user) {
                    const email = res.user.email || res.user.name || 'Signed in';
                    badge.textContent = email;
                    badge.title = email;
                } else {
                    badge.textContent = 'Not signed in';
                }
            }

            outBtn?.addEventListener('click', async () => {
                try { await window.AuthAPI?.logout?.(); } catch {}
                window.location.replace('./login.html');
            });
        } catch {}
    })();
</script>
</body>
</html>
